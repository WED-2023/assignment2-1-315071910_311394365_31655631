<template>
  <!-- Main container for the recipe preview list -->
  <b-container>
    <div class="header">
      <!-- Title of the recipe list -->
      <h3>
        {{ title }}:
        <slot></slot>
      </h3>
      <!-- Conditionally render the refresh button -->
      <button v-if="refreshButton" class="refresh-button" @click="updateRecipes">
        <i class="fas fa-sync-alt"></i>
      </button>
    </div>
    <!-- Row to contain recipe preview columns -->
    <b-row>
      <!-- Column for each recipe preview, responsive to screen size -->
      <b-col
        v-for="r in recipes"
        :key="r.id"
        cols="12"    
        md="6"       
        lg="4"       
      >
        <!-- Recipe preview component for each recipe -->
        <RecipePreview class="recipePreview" :recipe="r" />
      </b-col>
    </b-row>
  </b-container>
</template>

<script>
import RecipePreview from "./RecipePreview.vue";
import { mockGetRecipesPreview } from "../services/recipes.js";
import { eventBus } from "../services/user.js";

export default {
  name: "RecipePreviewList",
  components: {
    RecipePreview
  },
  props: {
    title: {
      type: String,
      required: true
    },
    refreshButton: {
      type: Boolean,
      default: true
    }
  },
  data() {
    return {
      recipes: [] // Data property to hold the list of recipes
    };
  },
  mounted() {
    this.updateRecipes(); // Fetch initial set of recipes when the component is mounted
    eventBus.$on('recipe-watched', this.updateRecipes); // Listen for watched event
    eventBus.$on('watched-recipes-cleared', this.updateRecipes); // Listen for clear event
},
beforeDestroy() {
  eventBus.$off('recipe-watched', this.updateRecipes); // Clean up event listener
  eventBus.$off('watched-recipes-cleared', this.updateRecipes); // Clean up event listener
  },
  methods: {
    async updateRecipes() {
      try {
        const amountToFetch = 3; // Set this to the number of recipes to fetch
        const response = await mockGetRecipesPreview(amountToFetch); // Mock API call to fetch recipes
        console.log(response);
        const recipes = response.data.recipes; // Extract recipes from the response
        console.log(recipes);
        this.recipes = recipes; // Assign fetched recipes to the data property
      } catch (error) {
        console.log(error); // Log any errors that occur during the fetch
      }
    }
  }
};
</script>

<style lang="scss" scoped>
.container {
  min-height: 400px; // Minimum height for the container
}

.header {
  display: flex; // Use flexbox for layout
  justify-content: space-between; // Space out items in the header
  align-items: center; // Center items vertically
}

.refresh-button {
  background: none; // Remove default button background
  border: none; // Remove default button border
  cursor: pointer; // Change cursor to pointer on hover
  font-size: 1.5rem; // Set font size
  color: #007bff; // Set color
  transition: transform 0.3s ease; // Smooth transition for transform property

  &:hover {
    transform: rotate(360deg); // Rotate icon on hover
  }
}

.recipePreview {
  margin-bottom: 20px; // Add bottom margin to each recipe preview
}
</style>
